<html>
	<head>
		<title>Test</title>
	</head>

	<body>
		<input id="name" type="text" value="fixme"></input>
		<button id="join" type="button">Join</button>
		<button id="assign" type="button">Assign</button>

		<p>
			You are: <span id="role">?</span>.
		</p>

		<ul id="player_list">
		</ul>

		<script src="http://code.jquery.com/jquery-2.1.3.js"></script>
		<script src="http://cdn.jsdelivr.net/sockjs/0.3.4/sockjs.min.js"></script>
		<script type="text/javascript">
//<!--
$(document).ready(function() {
	$("#join").click(function(evt) {
		var name = $("#name").val();
		var msg = ["change name", {"game": "causton", "player": name}];
		sock.send(JSON.stringify(msg))
	});

	$("#assign").click(function() {
		var msg = ["assign roles", {"special_characters": ["merlin", "assassin"]}];
		sock.send(JSON.stringify(msg));
	});

	//alert(window.location.hostname);
	var sock = new SockJS('http://HOST:8888/game/causton'.replace('HOST', window.location.hostname));
	sock.onopen = function() {
		console.log('open');
	};
	sock.onmessage = function(e) {
		console.log('message', e.data);
		msg = JSON.parse(e.data);
		pl = $("#player_list");
		pl.empty();
		var data = msg[1];
		for(name in data.players) {
			pl.append($('<li>').text(name + ' is ' + data.players[name]));
		}
		$("#role").text(data.my_role);
	};
	sock.onclose = function() {
		console.log('close');
	};
});
//-->
		</script>
	</body>
</html>
